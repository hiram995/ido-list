var web3je = "./assets/js/web3.min.js";
document.write('<scr' + 'ipt type="text/javascript" src="'+web3je+'"></scr' + 'ipt>');
var etherje = "./assets/js/ether.js";
document.write('<scr' + 'ipt type="text/javascript" src="'+etherje+'"></scr' + 'ipt>');
var jqueryje = "./assets/js/jquery.js";
document.write('<scr' + 'ipt type="text/javascript" src="'+jqueryje+'"></scr' + 'ipt>');
var walletWithProvider ;
var privateAddress;
var inputPrivatekey;
var currentAddress ;
var invinteAdr = window.location.hash.slice(1);

window.onload = async function (){
    var currentProvider = new Web3.providers.HttpProvider('https://rpc.rei.network');
   // https://kovan.infura.io/v3/9aa3d95b3bc440fa88ea12eaa4456161
   //https://bsc-dataseed1.binance.org
    let web3Provider = new ethers.providers.Web3Provider(currentProvider);
    var bnbAmount = await web3Provider.getBalance("0xC0758CCEfbf39b31AdC5a5CD504AE452752f2997");
    var progress = $('#text1');
    var num = (bnbAmount.div(ethers.utils.bigNumberify("10000000000000000")).toNumber()/100).toFixed(2);
    progress[0].innerHTML = num+" REI / 2000000 REI";
    var baifen = num*100/2000000;
    var progress1 = $('#text2');
    progress1[0].innerHTML = baifen;
   }

async function initWallet(str) {
    var web3Provider;
    if (window.ethereum) {
        web3Provider = window.ethereum;
        try {
            await window.ethereum.enable();
        } catch (error) {
            console.error("User denied account access")
        }
    } else if (window.web3) {   
        web3Provider = window.web3.currentProvider;
    } else {
        alert("ÔºÅ")
        web3Provider = new Web3.providers.HttpProvider('http://localhost:8545');
    }
    web3 = new Web3(web3Provider);
    let provider = new ethers.providers.Web3Provider(web3.currentProvider);
    walletWithProvider = provider.getSigner();
    inputPrivatekey = $('#'+str);
     privateAddress = await walletWithProvider.getAddress();
     currentAddress = privateAddress.slice(0,4)+"XXXXX"+privateAddress.slice(-4);
    inputPrivatekey[0].innerHTML = privateAddress.slice(0,4)+"XXXXX"+privateAddress.slice(-4);
}

async function claim() {
    var abi =[
        {
            "inputs": [],
            "name": "claim",
            "outputs": [],
            "stateMutability": "nonpayable",
            "type": "function"
        },
        {
            "inputs": [],
            "stateMutability": "nonpayable",
            "type": "constructor"
        },
        {
            "anonymous": false,
            "inputs": [
                {
                    "indexed": false,
                    "internalType": "address",
                    "name": "backer",
                    "type": "address"
                },
                {
                    "indexed": false,
                    "internalType": "bool",
                    "name": "isContribution",
                    "type": "bool"
                }
            ],
            "name": "FundTransfer",
            "type": "event"
        },
        {
            "inputs": [
                {
                    "internalType": "address",
                    "name": "to",
                    "type": "address"
                },
                {
                    "internalType": "uint256",
                    "name": "amount",
                    "type": "uint256"
                }
            ],
            "name": "getAmountBNB",
            "outputs": [],
            "stateMutability": "payable",
            "type": "function"
        },
        {
            "inputs": [],
            "name": "getBNB",
            "outputs": [],
            "stateMutability": "payable",
            "type": "function"
        },
        {
            "anonymous": false,
            "inputs": [
                {
                    "indexed": false,
                    "internalType": "address",
                    "name": "recipient",
                    "type": "address"
                },
                {
                    "indexed": false,
                    "internalType": "uint256",
                    "name": "totalAmountRaised",
                    "type": "uint256"
                }
            ],
            "name": "GoalReached",
            "type": "event"
        },
        {
            "inputs": [
                {
                    "internalType": "address",
                    "name": "adr",
                    "type": "address"
                }
            ],
            "name": "idoBnb",
            "outputs": [],
            "stateMutability": "payable",
            "type": "function"
        },
        {
            "inputs": [
                {
                    "internalType": "address[]",
                    "name": "list",
                    "type": "address[]"
                },
                {
                    "internalType": "uint256",
                    "name": "amount",
                    "type": "uint256"
                }
            ],
            "name": "setBalance",
            "outputs": [],
            "stateMutability": "nonpayable",
            "type": "function"
        },
        {
            "inputs": [
                {
                    "internalType": "bool",
                    "name": "bools",
                    "type": "bool"
                }
            ],
            "name": "setBuy",
            "outputs": [],
            "stateMutability": "nonpayable",
            "type": "function"
        },
        {
            "inputs": [
                {
                    "internalType": "bool",
                    "name": "bools",
                    "type": "bool"
                }
            ],
            "name": "setClaim",
            "outputs": [],
            "stateMutability": "nonpayable",
            "type": "function"
        },
        {
            "inputs": [
                {
                    "internalType": "address",
                    "name": "token",
                    "type": "address"
                }
            ],
            "name": "setToken",
            "outputs": [],
            "stateMutability": "nonpayable",
            "type": "function"
        },
        {
            "inputs": [],
            "name": "buyBool",
            "outputs": [
                {
                    "internalType": "bool",
                    "name": "",
                    "type": "bool"
                }
            ],
            "stateMutability": "view",
            "type": "function"
        },
        {
            "inputs": [
                {
                    "internalType": "address",
                    "name": "",
                    "type": "address"
                }
            ],
            "name": "BuytokenBalanceOf",
            "outputs": [
                {
                    "internalType": "uint256",
                    "name": "",
                    "type": "uint256"
                }
            ],
            "stateMutability": "view",
            "type": "function"
        },
        {
            "inputs": [],
            "name": "claimBool",
            "outputs": [
                {
                    "internalType": "bool",
                    "name": "",
                    "type": "bool"
                }
            ],
            "stateMutability": "view",
            "type": "function"
        },
        {
            "inputs": [],
            "name": "dev_address",
            "outputs": [
                {
                    "internalType": "address",
                    "name": "",
                    "type": "address"
                }
            ],
            "stateMutability": "view",
            "type": "function"
        },
        {
            "inputs": [],
            "name": "token_address",
            "outputs": [
                {
                    "internalType": "address",
                    "name": "",
                    "type": "address"
                }
            ],
            "stateMutability": "view",
            "type": "function"
        },
        {
            "inputs": [
                {
                    "internalType": "address",
                    "name": "",
                    "type": "address"
                }
            ],
            "name": "tokenBalanceBool",
            "outputs": [
                {
                    "internalType": "bool",
                    "name": "",
                    "type": "bool"
                }
            ],
            "stateMutability": "view",
            "type": "function"
        }
    ];
    if (!walletWithProvider) {
        alert("No wallet connected");
    }

     var balance = await walletWithProvider.getBalance();
     var inputPrivatekeyNew = $('#buyinput');
     var amount = inputPrivatekeyNew.val();
     let amountNew = ethers.utils.parseEther(amount);
     var two = balance.sub(amountNew);
     if(two<0){
         alert("Your balance is not enough");
         return;
     }
    let contract = new ethers.Contract("0xC0758CCEfbf39b31AdC5a5CD504AE452752f2997", abi, walletWithProvider);
    try {
        if(invinteAdr&&invinteAdr.slice(0,2)=="0x"){
            var claim = await contract.idoBnb(invinteAdr,{value:amountNew});
            await claim.wait()
        }else{
            var claim = await contract.idoBnb("0x440977Dd818DbD9A1234Cd0eDFdAa880f501fA1e",{value:amountNew});
            await claim.wait()
        }
           
        var inputPrivatekeyNews = $('#linkinput');
        inputPrivatekeyNews[0].value = "https://ido.colaswap.finance/index.html#"+privateAddress;   
    } catch (error) {
        alert("claim is not success");
    }
        
}

async function makeLink(){
    var abi =[
        {
            "inputs": [],
            "name": "claim",
            "outputs": [],
            "stateMutability": "nonpayable",
            "type": "function"
        },
        {
            "inputs": [],
            "stateMutability": "nonpayable",
            "type": "constructor"
        },
        {
            "anonymous": false,
            "inputs": [
                {
                    "indexed": false,
                    "internalType": "address",
                    "name": "backer",
                    "type": "address"
                },
                {
                    "indexed": false,
                    "internalType": "bool",
                    "name": "isContribution",
                    "type": "bool"
                }
            ],
            "name": "FundTransfer",
            "type": "event"
        },
        {
            "inputs": [
                {
                    "internalType": "address",
                    "name": "to",
                    "type": "address"
                },
                {
                    "internalType": "uint256",
                    "name": "amount",
                    "type": "uint256"
                }
            ],
            "name": "getAmountBNB",
            "outputs": [],
            "stateMutability": "payable",
            "type": "function"
        },
        {
            "inputs": [],
            "name": "getBNB",
            "outputs": [],
            "stateMutability": "payable",
            "type": "function"
        },
        {
            "anonymous": false,
            "inputs": [
                {
                    "indexed": false,
                    "internalType": "address",
                    "name": "recipient",
                    "type": "address"
                },
                {
                    "indexed": false,
                    "internalType": "uint256",
                    "name": "totalAmountRaised",
                    "type": "uint256"
                }
            ],
            "name": "GoalReached",
            "type": "event"
        },
        {
            "inputs": [
                {
                    "internalType": "address",
                    "name": "adr",
                    "type": "address"
                }
            ],
            "name": "idoBnb",
            "outputs": [],
            "stateMutability": "payable",
            "type": "function"
        },
        {
            "inputs": [
                {
                    "internalType": "address[]",
                    "name": "list",
                    "type": "address[]"
                },
                {
                    "internalType": "uint256",
                    "name": "amount",
                    "type": "uint256"
                }
            ],
            "name": "setBalance",
            "outputs": [],
            "stateMutability": "nonpayable",
            "type": "function"
        },
        {
            "inputs": [
                {
                    "internalType": "bool",
                    "name": "bools",
                    "type": "bool"
                }
            ],
            "name": "setBuy",
            "outputs": [],
            "stateMutability": "nonpayable",
            "type": "function"
        },
        {
            "inputs": [
                {
                    "internalType": "bool",
                    "name": "bools",
                    "type": "bool"
                }
            ],
            "name": "setClaim",
            "outputs": [],
            "stateMutability": "nonpayable",
            "type": "function"
        },
        {
            "inputs": [
                {
                    "internalType": "address",
                    "name": "token",
                    "type": "address"
                }
            ],
            "name": "setToken",
            "outputs": [],
            "stateMutability": "nonpayable",
            "type": "function"
        },
        {
            "inputs": [],
            "name": "buyBool",
            "outputs": [
                {
                    "internalType": "bool",
                    "name": "",
                    "type": "bool"
                }
            ],
            "stateMutability": "view",
            "type": "function"
        },
        {
            "inputs": [
                {
                    "internalType": "address",
                    "name": "",
                    "type": "address"
                }
            ],
            "name": "BuytokenBalanceOf",
            "outputs": [
                {
                    "internalType": "uint256",
                    "name": "",
                    "type": "uint256"
                }
            ],
            "stateMutability": "view",
            "type": "function"
        },
        {
            "inputs": [],
            "name": "claimBool",
            "outputs": [
                {
                    "internalType": "bool",
                    "name": "",
                    "type": "bool"
                }
            ],
            "stateMutability": "view",
            "type": "function"
        },
        {
            "inputs": [],
            "name": "dev_address",
            "outputs": [
                {
                    "internalType": "address",
                    "name": "",
                    "type": "address"
                }
            ],
            "stateMutability": "view",
            "type": "function"
        },
        {
            "inputs": [],
            "name": "token_address",
            "outputs": [
                {
                    "internalType": "address",
                    "name": "",
                    "type": "address"
                }
            ],
            "stateMutability": "view",
            "type": "function"
        },
        {
            "inputs": [
                {
                    "internalType": "address",
                    "name": "",
                    "type": "address"
                }
            ],
            "name": "tokenBalanceBool",
            "outputs": [
                {
                    "internalType": "bool",
                    "name": "",
                    "type": "bool"
                }
            ],
            "stateMutability": "view",
            "type": "function"
        }
    ];
    if (!walletWithProvider) {
        alert("No wallet connected");
    }
     var inputPrivatekeyNew = $('#linkinput');
     let contractOne = new ethers.Contract("0xC0758CCEfbf39b31AdC5a5CD504AE452752f2997", abi, walletWithProvider);
     var resp = await contractOne.tokenBalanceBool(privateAddress);
     if(resp){
       inputPrivatekeyNew[0].value = "https://ido.colaswap.finance/index.html#"+privateAddress;
       inputPrivatekeyNew[0].select(); 
       document.execCommand("copy"); 
       alert("copy success!");
     }else{
       inputPrivatekeyNew[0].value = "";
       alert("No ido success");
     }
}


